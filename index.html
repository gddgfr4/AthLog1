<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>AthLog</title>

  <!-- PWA/アイコン（無ければ削っても動作OK） -->
  <link rel="manifest" href="./manifest.webmanifest?v=2">
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16.png">
  <link rel="apple-touch-icon" href="./apple-touch-icon-180.png">

  <!-- ベースCSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- 筋マップ画像を先読み（同階層に human.webp を置く） -->
  <link rel="preload" href="human.webp" as="image" imagesrcset="human.webp" />

  <!-- ライブラリ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="app" class="app hidden">
    <header class="topbar">
      <button class="ghost" id="openHelpBtn">ヘルプ</button>
      <div class="brand">AthLog</div>
      <div class="teamuser" style="display:flex; align-items:center; gap:12px;">
        <span>Team: <b id="teamLabel"></b></span>
        <span style="display:flex; align-items:center; gap:8px;">
          表示中: <b id="memberLabel"></b>
          <span id="mainTeamBadge" class="badge primary hidden" title="このチームはあなたのメインです">MAIN</span>
          <span id="readonlyBadge" class="badge warn hidden" title="このチームでは編集できません">閲覧のみ</span>
          <select id="memberSelect" class="ghost" style="padding: 4px 6px;"></select>
        </span>
       <div id="teamSwitchWrap" class="team-switch" style="display:flex; align-items:center; gap:8px;">
         <span class="muted">チーム:</span>
         <select id="teamSwitchSelect" class="ghost" style="padding:4px 6px; min-width:140px;"></select>
         <button id="addTeamBtn" class="ghost">＋追加</button>
         <button id="setAsMainBtn" class="ghost" title="このチームをメインにする">メインに設定</button>
       </div>
        <button id="logoutBtn" class="ghost">ログアウト</button>
      </div>
    </header>

    <nav class="tabs">
      <button data-tab="journal" class="tab active">日誌</button>
      <button data-tab="month" class="tab">月一覧</button>
      <button data-tab="plans" class="tab">予定</button>
      <button data-tab="dashboard" class="tab">グラフ</button>
      <button data-tab="memo" class="tab">メモ</button>
      <button data-tab="notify" class="tab">通知</button>
      <!-- 追加: 時計タブ -->
      <button class="tab" data-tab="clock">時計</button>
    </nav>
    <!-- 画面上部 共通スワイプバー（透明） -->
    <div id="globalSwipeBar" aria-hidden="true"></div>


    <!-- ===== JOURNAL ===== -->
    <section id="journal" class="tabpanel active">
      <div class="journal-grid">
        <div class="panel">
          <h3>筋疲労</h3>

          <div class="palette">
            <button class="lvl active" data-lvl="1"><span class="dot dot1"></span>1</button>
            <button class="lvl" data-lvl="2"><span class="dot dot2"></span>2</button>
            <button class="lvl" data-lvl="3"><span class="dot dot3"></span>3</button>
            <button id="eraser" class="lvl">消しゴム</button>
          </div>

          <!-- 画像＋キャンバス3枚を完全重ね（ズレ防止のため id=mmWrap 必須） -->
          <div id="mmWrap">
            <!-- 表示用の下地画像（pointer-events: none で操作は上のCanvasへ） -->
            <img id="mmBg" src="./human.webp" alt="" style="display:block;width:100%;height:auto;pointer-events:none;">

            <!-- 解析用ベース（非表示でOK / JSが描画に使用） -->
            <canvas id="mmBase"></canvas>

            <!-- 見えない“壁” -->
            <canvas id="mmBarrier"></canvas>

            <!-- ユーザが塗るオーバーレイ -->
            <canvas id="mmOverlay"></canvas>
          </div>
        </div>

        <div class="panel right">
          <div class="weekbar">
            <button id="weekPrev" class="ghost">&larr;</button>
            <div id="weekChips" class="chips"></div>
            <button id="weekNext" class="ghost">&rarr;</button>
            <span id="weekMonthLabel" class="muted"></span>
            <input type="date" id="datePicker" />
            <button id="gotoToday" class="ghost">今日へ</button>
          </div>

          <div class="quick" style="justify-content:center;">
            <button class="qbtn jog">ジョグ</button>
            <button class="qbtn point">ポイント</button>
            <button class="qbtn sup">補強</button>
            <button class="qbtn off">オフ</button>
            <button class="qbtn other">その他</button>
          </div>

          <div class="formcol">
            <div style="display:flex; gap:12px; align-items:flex-start;">
              <div style="flex:1;">
                <label>走行距離(km)</label>
                <input type="number" id="distInput" step="0.1" min="0" />
              </div>
              <div>
                <label>調子</label>
                <div id="conditionBtns" class="condition-rating">
                  <button data-val="1">1</button>
                  <button data-val="2">2</button>
                  <button data-val="3">3</button>
                  <button data-val="4">4</button>
                  <button data-val="5">5</button>
                </div>
              </div>
            </div>

            <div class="note">
              <label>練習内容</label>
              <textarea id="trainInput" rows="3"></textarea>
              <div class="merge">
                <select id="mergeScope" class="ghost"></select>
                <input id="mergeTagFilter" class="ghost" placeholder="タグ(,区切り)" />
                <button id="mergeBtn" class="ghost">反映</button>
              </div>
            </div>

            <div class="note">
              <label>タイム・感想</label>
              <textarea id="feelInput" rows="5"></textarea>
            </div>

            <div class="savebar">
             <div id="distanceSummary" class="muted">読み込み中…</div>
            </div>

      
            <div class="note" id="teamSharedCommentBox">
              <label>コメント(全員編集可)</label>
              <textarea id="teamSharedComment" rows="3" placeholder="この日の共有コメント…"></textarea>
              <div id="teamSharedCommentStatus" class="muted" style="font-size:12px;margin-top:4px;"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== MONTH LIST ===== -->
    <section id="month" class="tabpanel">
      <div class="monthbar">
        <button id="mPrev" class="ghost">&larr;</button>
        <input type="month" id="monthPick" />
        <button id="mNext" class="ghost">&rarr;</button>
        <div id="monthSum" class="muted"></div>
      </div>

      <div class="panel" style="margin-bottom:12px;">
        <label for="monthGoalInput"><strong>月間目標</strong></label>
        <textarea id="monthGoalInput" class="form-control" rows="2" style="width:100%; margin-top:4px;"></textarea>
      </div>

      <div id="monthList" class="list"></div>
    </section>

    <!-- ===== PLANS ===== -->
    <section id="plans" class="tabpanel">
      <div class="monthbar">
        <button id="pPrev" class="ghost">&larr;</button>
        <input type="month" id="planMonthPick" />
        <button id="pNext" class="ghost">&rarr;</button>
        <div class="filters" style="margin-left:auto;">
          <select id="planScope" class="ghost"></select>
          <input id="tagFilter" placeholder="タグ(,区切り)" />
        </div>
      </div>

      <!-- ▼ 追加: 予定入力のポイント詳細（ポイント時のみ使用） -->
      <div class="panel" id="planAdvanced" style="display:none; gap:8px; align-items:center;">
        <label>ポイント種別</label>
        <select id="pointSubtype">
          <option value="pace">ペース走</option>
          <option value="interval">インターバル</option>
        </select>
        <label>距離(m)</label>
        <input id="pointDistance" type="number" min="50" step="50" placeholder="1000" />
      </div>

      <div class="chatwrap" style="margin-bottom:12px;">
        <button id="toggleChat" class="ghost">月コメント</button>
        <div id="chatBox" class="chat hidden">
          <div id="chatLog" class="chatlog"></div>
          <input id="chatInput" placeholder="コメント..." />
        </div>
      </div>

      <div id="planList" class="list"></div>
    </section>
    <!-- ===== DASHBOARD ===== -->
    <section id="dashboard" class="tabpanel">
      <div class="panel" style="margin-bottom:12px;">
        <!-- 旧: 切り替えボタンや1枚キャンバスは削除 -->
        <!-- 新: 3枚の距離グラフを縦並び -->
    
        <div class="card">
          <h3>
            <button id="distDayPrev" class="ghost" style="margin-right:6px;">&larr;</button>
            <span id="distChartTitleDay">日別走行距離（直近14日）</span>
            <button id="distDayNext" class="ghost" style="margin-left:6px;">&rarr;</button>
          </h3>
          <canvas id="distanceChartDay" height="180"></canvas>
        </div>
    
        <div class="card">
          <h3>
            <button id="distWeekPrev" class="ghost" style="margin-right:6px;">&larr;</button>
            <span id="distChartTitleWeek">週間走行距離（直近6週）</span>
            <button id="distWeekNext" class="ghost" style="margin-left:6px;">&rarr;</button>
          </h3>
          <canvas id="distanceChartWeek" height="180"></canvas>
        </div>
    
        <div class="card">
          <h3>
            <button id="distMonthPrev" class="ghost" style="margin-right:6px;">&larr;</button>
            <span id="distChartTitleMonth">月間走行距離（直近6か月）</span>
            <button id="distMonthNext" class="ghost" style="margin-left:6px;">&rarr;</button>
          </h3>
          <canvas id="distanceChartMonth" height="180"></canvas>
        </div>
      </div>
    
      <div class="panel">
        <div class="dash-header">
          <h3>コンディション推移</h3>
          <div class="dash-controls">
            <button id="condChartPrev" class="ghost">&larr;</button>
            <span id="condChartRange" class="muted"></span>
            <button id="condChartNext" class="ghost">&rarr;</button>
          </div>
        </div>
        <div style="height:250px;">
          <canvas id="conditionChart"></canvas>
        </div>
      </div>
    </section>



    <!-- ===== TEAM MEMO ===== -->
    <section id="memo" class="tabpanel">
      <div class="panel">
        <h3>チームメモ</h3>
        <div id="memoChatBox" class="chat">
          <div id="memoChatLog" class="chatlog" style="max-height:400px;"></div>
          <div class="chat-input-area">
            <input id="memoChatInput" class="form-control" placeholder="チーム全体へのメッセージ..." />
            <button id="memoSendBtn" class="primary">送信</button>
          </div>
        </div>
      </div>
    </section>

    <section id="notify" class="tabpanel">
      <div class="panel">
        <h3>通知</h3>
        <div id="notifyList" class="chatlog"></div>
        <div class="muted" id="notifyEmpty" style="display:none; padding:12px 0;">
          新しい通知はありません
        </div>
      </div>
    </section>

    <!-- ===== CLOCK (Ltimer風) ===== -->
    <section id="clock" class="tabpanel" style="display:none;">
      <div class="ltimer">
        <div class="ltimer-header">
          <h2 id="clock-title">計測</h2>
          <div id="clock-meta" class="muted">プリセットなし</div>
        </div>
        <div class="ltimer-face">
          <div id="clock-display">00:00.000</div>
        </div>
        <div class="ltimer-controls">
          <button id="btn-start">Start</button>
          <button id="btn-lap" disabled>Lap</button>
          <button id="btn-stop" disabled>Stop</button>
          <button id="btn-reset" disabled>Reset</button>
          <button id="btn-save" disabled>結果を日誌へ</button>
        </div>
        <div class="ltimer-laps">
          <ol id="lap-list"></ol>
        </div>
      </div>
    </section>
  </div>

  <!-- LOGIN -->
  <div id="login" class="login">
    <div class="login-card">
      <div class="logo">AthLog</div>
      <div class="desc">中長距離のための日誌</div>
      <label>Team ID</label>
      <input id="teamId" />
      <label>Member</label>
      <input id="memberName" />
      <button id="loginBtn" class="primary wide">はじめる</button>
    </div>
  </div>

  <!-- Firebase SDK（※二重読込はしない） -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- ← この“直後”に初期化を置く（app.jsより前） -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA8oCOusnqZCSax9ZY3-n4KNt2AxEmvT-E",
      authDomain: "athlog-126d2.firebaseapp.com",
      projectId: "athlog-126d2",
      storageBucket: "athlog-126d2.appspot.com",
      messagingSenderId: "784178114661",
      appId: "1:784178114661:web:d41103b0dad1187b85168c"
    };
    if (!firebase.apps || !firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
  </script>
  <!-- アプリ本体 -->
  <script src="app.js?v=20250824" defer></script>

  <!-- ヘルプオーバーレイ -->
  <div id="helpOverlay" class="login hidden">
    <div class="login-card" style="max-width:860px; width:min(96vw,860px); max-height:85vh; overflow:auto;">
      <div class="logo">AthLog クイックガイド</div>
      <div class="desc">最短で使い始めるための要点まとめ</div>
      <div id="helpBody" class="doc"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button class="ghost" id="helpClose">閉じる</button>
      </div>
    </div>
  </div>

  <noscript>
    <div style="padding:16px; font-family: system-ui, -apple-system, Segoe UI, Roboto;">
      このアプリを利用するには JavaScript を有効にしてください。
    </div>
  </noscript>
 
<!-- ▼▼ 追加: 時計用スタイル（最小限）＋ ログイン注意＆日誌コメントの既存スタイル ▼▼ -->
<style>
  /* ログイン注意文 */
  .login-note{font-size:12px;color:#6b7280;margin-top:8px;line-height:1.6}

  /* 日ごとのコメント欄（AIコメントの直後に置く） */
  .comment-box { margin-top: 12px; padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; background: #fafafa; }
  #daynote-text { width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; resize: vertical; }

  /* 時計タブ時は上部共通UIを隠す */
  .mode-clock .topbar,
  .mode-clock .tabs,
  .mode-clock #globalSwipeBar{ display:none !important; }

  /* Ltimer 風（最小） */
  .ltimer { max-width: 720px; margin: 12px auto; display: grid; gap: 12px; padding: 0 12px; }
  .ltimer-face { display:flex; justify-content:center; padding: 12px 0; }
  #clock-display { font-size: clamp(40px, 8vw, 80px); letter-spacing:.02em; font-variant-numeric: tabular-nums; }
  .ltimer-controls { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
  .ltimer-controls button { padding:10px 16px; border-radius:12px; border:1px solid #333; background:#151517; color:#eee; cursor:pointer; }
  .ltimer-laps { background:#0e0e10; border:1px solid #222; border-radius:12px; padding:8px 12px; max-height:45vh; overflow:auto; }
  #lap-list { margin:0; padding-left: 20px; }
  #lap-list li { padding:6px 0; border-bottom:1px dashed #222; }
  #lap-list li:last-child { border-bottom:none; }
</style>

<script>
/* ===== ログイン画面の注意書きを追加（IDは実体に合わせて loginBtn） ===== */
(function(){
  function addLoginNote(){
    const startBtn = document.getElementById('loginBtn');
    if(!startBtn) return;
    if (document.querySelector('.login-note')) return; // 重複防止
    const note = document.createElement('p');
    note.className = 'login-note';
    note.innerHTML =
      '※ 次回以降は自動ログインとなります。<br>' +
      '※ チーム名と名前は<strong>完全一致</strong>が必要です（スペースや全角・半角にご注意ください）。';
    startBtn.insertAdjacentElement('afterend', note);
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', addLoginNote);
  } else {
    addLoginNote();
  }
})();
</script>

<script>
/* ===== 予定: ポイント詳細（ポイント選択時だけ表示するためのフック。既存UI側から使う） ===== */
(function(){
  // もし既存の予定入力UIが select#planType を使っている場合の例。無ければスキップ。
  const typeSel = document.getElementById('planType') || document.getElementById('sessionType');
  const adv = document.getElementById('planAdvanced');
  if (!adv) return;
  function sync(){ adv.style.display = (typeSel && typeSel.value === 'point') ? 'flex' : 'none'; }
  if (typeSel) { typeSel.addEventListener('change', sync); sync(); }
})();
</script>

<script>
/* ===== 時計タブ入場時のUI調整 + プリセット表示（最小版） ===== */
(function(){
  const tabs = document.querySelectorAll('.tabs .tab');
  const clockTab = Array.from(tabs).find(b=>b.dataset.tab==='clock');
  const sections = {
    journal: document.getElementById('journal'),
    month: document.getElementById('month'),
    plans: document.getElementById('plans'),
    dashboard: document.getElementById('dashboard'),
    memo: document.getElementById('memo'),
    notify: document.getElementById('notify'),
    clock: document.getElementById('clock')
  };
  function show(name){
    Object.entries(sections).forEach(([k,el])=>{ if(el) el.style.display = (k===name)?'block':'none'; });
    if (name==='clock') { document.body.classList.add('mode-clock'); applyClockPreset(); initClockOnce(); }
    else { document.body.classList.remove('mode-clock'); }
  }
  // 既存のタブ制御がある場合はそれを尊重。ここはフォールバックとしてだけ機能。
  if (clockTab) {
    clockTab.addEventListener('click', ()=>show('clock'));
  }

  function loadClockPreset(){
    try { return JSON.parse(localStorage.getItem('clockPreset')||'null'); } catch { return null; }
  }
  function applyClockPreset(){
    const p = loadClockPreset();
    const meta = document.getElementById('clock-meta');
    const title = document.getElementById('clock-title');
    if (!meta || !title) return;
    if (p && p.type==='point'){
      const typeJ = p.subtype==='interval'?'インターバル':'ペース走';
      const d = p.distance ? `${p.distance}m` : '';
      meta.textContent = [typeJ, d, p.date||''].filter(Boolean).join(' / ');
      title.textContent = 'ポイント計測';
    } else if (p){
      meta.textContent = p.note || p.date || 'プリセットあり';
      title.textContent = '計測';
    } else {
      meta.textContent = 'プリセットなし';
      title.textContent = '計測';
    }
  }

  let inited=false;
  function initClockOnce(){ if(inited) return; inited=true; initClock(); }

  function initClock(){
    const elDisplay = document.getElementById('clock-display');
    const elLapList = document.getElementById('lap-list');
    const btnStart  = document.getElementById('btn-start');
    const btnLap    = document.getElementById('btn-lap');
    const btnStop   = document.getElementById('btn-stop');
    const btnReset  = document.getElementById('btn-reset');
    const btnSave   = document.getElementById('btn-save');
    if (!elDisplay) return;

    let running=false, startMs=0, elapsedMs=0, rafId=null, laps=[];
    const fmt = (ms)=>{ const m=Math.floor(ms/60000), s=Math.floor((ms%60000)/1000), ms3=String(ms%1000).padStart(3,'0'); return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${ms3}`; };
    const tick=()=>{ const now=performance.now(); const total=elapsedMs+(now-startMs); elDisplay.textContent=fmt(total|0); rafId=requestAnimationFrame(tick); };
    const ui=()=>{ btnStart.disabled=running; btnLap.disabled=!running; btnStop.disabled=!running; btnReset.disabled=running||(!elapsedMs&&!laps.length); btnSave.disabled=running||(!laps.length); };
    const vibrate = (p)=>{ try{ navigator.vibrate?.(p); }catch{} };

    btnStart?.addEventListener('click', ()=>{ if(running) return; running=true; startMs=performance.now(); vibrate(10); ui(); rafId=requestAnimationFrame(tick); });
    btnLap?.addEventListener('click', ()=>{ if(!running) return; const now=performance.now(); const total=elapsedMs+(now-startMs); const last=laps.reduce((a,b)=>a+b,0); const split=total-last; laps.push(split); const li=document.createElement('li'); li.textContent=`Lap ${laps.length}: ${fmt(split|0)}`; elLapList.prepend(li); vibrate(5); });
    btnStop?.addEventListener('click', ()=>{ if(!running) return; cancelAnimationFrame(rafId); elapsedMs += (performance.now()-startMs); running=false; vibrate([10,40,10]); ui(); });
    btnReset?.addEventListener('click', ()=>{ cancelAnimationFrame(rafId); running=false; startMs=0; elapsedMs=0; laps=[]; elDisplay.textContent='00:00.000'; elLapList.innerHTML=''; ui(); });
    btnSave?.addEventListener('click', ()=>{
      const p = (function(){ try{ return JSON.parse(localStorage.getItem('clockPreset')||'null'); }catch{return null;} })() || {};
      const date = p.date || new Date().toISOString().slice(0,10);
      const header = (p.type==='point') ? `【ポイント結果】${p.subtype==='interval'?'インターバル':'ペース走'} ${p.distance?`${p.distance}m`:''}` : '【計測結果】';
      const text = `${header}\n${laps.map((t,i)=>`Lap ${i+1}: ${fmt(t|0)}`).join('\n')}`;
      if (window.addDiaryEntry) { window.addDiaryEntry({date, text}); }
      else { const key=`diary:${date}`; const prev=localStorage.getItem(key)||''; localStorage.setItem(key, prev?`${prev}\n${text}`:text); }
      alert('結果を日誌に保存しました。');
    });

    ui();
  }
})();
</script>

<script>
(function(){
  try {
    if (!window.firebase || !firebase.firestore) return; // Firestore未読込なら何もしない
  } catch(e) { return; }

  const db = firebase.firestore();

  function getDateKey(){
    const inp = document.getElementById('datePicker');
    const val = inp && inp.value;
    if (val && /^\d{4}-\d{2}-\d{2}$/.test(val)) return val;
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }

  const $text = document.getElementById('daynote-text');
  const $status = document.getElementById('daynote-status');
  if (!$text || !$status) return; // DOMが無い画面では実行しない

  let currentDateKey = null;
  let saveTimer = null, dirty = false;

  async function loadNote(dateKey){
    try{
      const snap = await db.collection('dayNotes').doc(dateKey).get();
      $text.value = snap.exists ? (snap.data().text || '') : '';
      $status.textContent = `日付: ${dateKey} ／ 状態: 参照OK`;
    }catch(e){
      console.error(e);
      $status.textContent = `日付: ${dateKey} ／ 読み込み失敗`;
    }
  }

  async function saveNote(dateKey, text){
    try{
      await db.collection('dayNotes').doc(dateKey).set(
        { text, updatedAt: firebase.firestore.FieldValue.serverTimestamp() },
        { merge: true }
      );
      dirty = false;
      $status.textContent = `日付: ${dateKey} ／ 保存済み`;
    }catch(e){
      console.error(e);
      $status.textContent = `日付: ${dateKey} ／ 保存失敗（自動再試行）`;
      setTimeout(()=>scheduleSave(), 1500);
    }
  }

  function scheduleSave(){
    dirty = true;
    const dateKey = currentDateKey || getDateKey();
    $status.textContent = `日付: ${dateKey} ／ 保存待ち…`;
    clearTimeout(saveTimer);
    saveTimer = setTimeout(()=>{
      saveNote(dateKey, $text.value);
    }, 800);
  }

  function init(){
    currentDateKey = getDateKey();
    loadNote(currentDateKey);
  }

  $text.addEventListener('input', scheduleSave);

  const datePicker = document.getElementById('datePicker');
  if (datePicker) {
    datePicker.addEventListener('change', ()=>{
      currentDateKey = getDateKey();
      loadNote(currentDateKey);
    });
  }

  window.addEventListener('beforeunload', ()=>{
    if (dirty) {
      try { saveNote(currentDateKey || getDateKey(), $text.value); } catch(e){}
    }
  });

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
<!-- ▲▲ 最終版ここまで ▲▲ -->
<!-- index.html: body閉じタグ直前に追加 -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js').catch(console.error);
    });
  }
</script>

</body>
</html>


