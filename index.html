<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>AthLog</title>
  <link rel="manifest" href="./manifest.webmanifest?v=2">
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png">
  <link rel="apple-touch-icon" href="./apple-touch-icon-180.png">
  <link rel="stylesheet" href="style.css" />
  <link rel="preload" href="human.webp" as="image" imagesrcset="human.webp" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="app" class="app hidden">
    <header class="topbar">
      <button class="ghost" id="openHelpBtn">ãƒ˜ãƒ«ãƒ—</button>
      <div class="brand">AthLog</div>
      <div class="teamuser" style="display:flex; align-items:center; gap:12px;">
        <span>Team: <b id="teamLabel"></b></span>
        <span id="memberNavWrap" style="display:flex; align-items:center; gap:4px;">
          <button id="memberPrev" class="ghost small-btn">&lt;</button>
          <span style="display:flex; align-items:center; gap:8px;">
            <b id="memberLabel"></b>
            <span id="mainTeamBadge" class="badge primary hidden">MAIN</span>
            <span id="readonlyBadge" class="badge warn hidden">é–²è¦§ã®ã¿</span>
          </span>
          <select id="memberSelect" class="ghost" style="padding: 4px 6px;"></select>
          <button id="memberNext" class="ghost small-btn">&gt;</button>
        </span>
        <div id="teamSwitchWrap" class="team-switch" style="display:flex; align-items:center; gap:8px;">
          <select id="teamSwitchSelect" class="ghost" style="padding:4px 6px; min-width:140px;"></select>
          <button id="addTeamBtn" class="ghost">ï¼‹</button>
          <button id="setAsMainBtn" class="ghost">â˜…</button>
        </div>
        <button id="logoutBtn" class="ghost">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </header>

    <nav class="tabs">
      <button data-tab="journal" class="tab active">æ—¥èªŒ</button>
      <button data-tab="month" class="tab">æœˆä¸€è¦§</button>
      <button data-tab="plans" class="tab">äºˆå®š</button>
      <button data-tab="dashboard" class="tab">ã‚°ãƒ©ãƒ•</button>
      <button data-tab="ai_coach" class="tab">AIã‚³ãƒ¼ãƒ</button><button data-tab="memo" class="tab">ãƒ¡ãƒ¢</button>
      <button data-tab="notify" class="tab">é€šçŸ¥</button>
      <button class="tab" data-tab="clock">æ™‚è¨ˆ</button>
      <button class="tab" data-tab="stadium">ç«¶æŠ€å ´</button>
    </nav>
    <div id="globalSwipeBar" aria-hidden="true"></div>

    <section id="journal" class="tabpanel active">
      <div class="journal-grid">
        <div class="panel">
          <div class="muscle-header">
            <h3>ç­‹ç–²åŠ´</h3>
            <div class="palette">
              <button class="lvl active" data-lvl="1"><span class="dot dot1"></span>1</button>
              <button class="lvl" data-lvl="2"><span class="dot dot2"></span>2</button>
              <button class="lvl" data-lvl="3"><span class="dot dot3"></span>3</button>
              <button id="eraser" class="lvl">ğŸ§¼</button>
            </div>
          </div>
          <div id="mmWrap">
            <img id="mmBg" src="./human.webp" alt="" style="display:block;width:100%;height:auto;pointer-events:none;">
            <canvas id="mmBase"></canvas>
            <canvas id="mmBarrier"></canvas>
            <canvas id="mmOverlay"></canvas>
          </div>

          <div style="margin-top:12px; border-top:1px dashed var(--line); padding-top:8px;">
            <div style="font-size:12px; font-weight:bold; margin-bottom:6px;">âš¡ï¸ AIåˆ†æç”¨ãƒ‡ãƒ¼ã‚¿ (ã‚¿ãƒƒãƒ—ã§å¼·åº¦å¤‰æ›´)</div>
            <div id="partsTagArea" class="parts-tag-area">
              </div>
          </div>
        </div>

        <div class="panel right">
          <div class="weekbar">
            <button id="weekPrev" class="ghost">&larr;</button>
            <div id="weekChips" class="chips"></div>
            <button id="weekNext" class="ghost">&rarr;</button>
            <input type="date" id="datePicker" />
            <button id="gotoToday" class="ghost">ä»Šæ—¥</button>
            <button id="shareModeBtn" class="ghost">ğŸ“·</button>
          </div>

          <div class="quick" style="justify-content:center;">
            <button class="qbtn jog">ã‚¸ãƒ§ã‚°</button>
            <button class="qbtn point">ãƒã‚¤ãƒ³ãƒˆ</button>
            <button class="qbtn sup">è£œå¼·</button>
            <button class="qbtn off">ã‚ªãƒ•</button>
            <button class="qbtn other">ãã®ä»–</button>
          </div>

          <div class="formcol">
            <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:flex-end;">
              <div style="width: 70px;">
                <label>è·é›¢(km)</label>
                <input type="number" id="distInput" step="0.1" min="0" />
              </div>
              <div style="width: 70px;">
                <label>ä½“é‡(kg)</label>
                <input type="number" id="weightInput" step="0.1" min="0" />
              </div>
              <div style="flex:1; min-width:150px;">
                <label>èª¿å­</label>
                <div id="conditionBtns" class="condition-rating">
                  <button data-val="1">1</button>
                  <button data-val="2">2</button>
                  <button data-val="3">3</button>
                  <button data-val="4">4</button>
                  <button data-val="5">5</button>
                </div>
              </div>
            </div>
            <div class="note">
              <label>ç·´ç¿’å†…å®¹</label>
              <textarea id="trainInput" rows="3"></textarea>
              <div class="merge">
                <select id="mergeScope" class="ghost"></select>
                <input id="mergeTagFilter" class="ghost" placeholder="ã‚¿ã‚°" />
                <button id="mergeBtn" class="ghost">åæ˜ </button>
              </div>
            </div>
            <div class="note">
              <label>ã‚¿ã‚¤ãƒ ãƒ»æ„Ÿæƒ³</label>
              <textarea id="feelInput" rows="6"></textarea>
            </div>
            <div class="savebar">
             <div id="distanceSummary" class="muted">...</div>
            </div>
            <div class="note" id="teamSharedCommentBox">
              <label>ã‚³ãƒ¡ãƒ³ãƒˆ</label>
              <textarea id="teamSharedComment" rows="2" placeholder="å…±æœ‰ã‚³ãƒ¡ãƒ³ãƒˆ..."></textarea>
              <div style="display:flex; justify-content:space-between; align-items:center; margin-top:4px;">
                <div id="teamSharedCommentStatus" class="muted"></div>
                <button id="tscSendBtn" class="primary">é€ä¿¡</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="month" class="tabpanel">
      <div class="monthbar">
        <button id="mPrev" class="ghost">&larr;</button>
        <input type="month" id="monthPick" />
        <button id="mNext" class="ghost">&rarr;</button>
        <div id="monthSum" class="muted"></div>
      </div>
      <div class="panel" style="margin-bottom:12px;">
        <label for="monthGoalInput"><strong>æœˆé–“ç›®æ¨™</strong></label>
        <textarea id="monthGoalInput" class="form-control" rows="2"></textarea>
      </div>
      <div id="monthList" class="list"></div>
    </section>

    <section id="plans" class="tabpanel">
      <div class="monthbar">
        <button id="pPrev" class="ghost">&larr;</button>
        <input type="month" id="planMonthPick" />
        <button id="pNext" class="ghost">&rarr;</button>
        <div class="filters" style="margin-left:auto;">
          <select id="planScope" class="ghost"></select>
        </div>
      </div>
      <div class="panel" id="planAdvanced" style="display:none; gap:8px; align-items:center;">
        <label>ç¨®åˆ¥</label>
        <select id="pointSubtype"><option value="pace">ãƒšãƒ¼ã‚¹èµ°</option><option value="interval">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«</option></select>
        <label>è·é›¢</label>
        <input id="pointDistance" type="number" step="50" placeholder="1000" />
      </div>
      <div id="planList" class="list" style="margin-top:10px;"></div>
    </section>

    <section id="dashboard" class="tabpanel">
      <div class="panel" style="margin-bottom:12px;">
        <div class="card">
          <h3>
            <button id="distDayPrev" class="ghost">&larr;</button>
            <span id="distChartTitleDay">æ—¥åˆ¥</span>
            <button id="distDayNext" class="ghost">&rarr;</button>
          </h3>
          <canvas id="distanceChartDay" height="180"></canvas>
        </div>
        <div class="card" style="margin-top:10px;">
          <h3>
            <button id="distWeekPrev" class="ghost">&larr;</button>
            <span id="distChartTitleWeek">é€±é–“</span>
            <button id="distWeekNext" class="ghost">&rarr;</button>
          </h3>
          <canvas id="distanceChartWeek" height="180"></canvas>
        </div>
        <div class="card" style="margin-top:10px;">
          <h3>
            <button id="distMonthPrev" class="ghost">&larr;</button>
            <span id="distChartTitleMonth">æœˆé–“</span>
            <button id="distMonthNext" class="ghost">&rarr;</button>
          </h3>
          <canvas id="distanceChartMonth" height="180"></canvas>
        </div>
      </div>
      <div class="panel">
        <div class="dash-header">
          <h3>ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³</h3>
          <div class="dash-controls">
            <button id="condChartPrev" class="ghost">&larr;</button>
            <span id="condChartRange" class="muted"></span>
            <button id="condChartNext" class="ghost">&rarr;</button>
          </div>
        </div>
        <div style="height:250px;"><canvas id="conditionChart"></canvas></div>
      </div>
      <div class="panel" style="margin-top:12px;">
        <div class="dash-header">
          <h3>ä½“é‡</h3>
          <div class="dash-controls">
            <button id="weightModeBtn" class="ghost">æ—¥</button>
            <button id="weightPrev" class="ghost">&larr;</button>
            <span id="weightRangeLabel" class="muted"></span>
            <button id="weightNext" class="ghost">&rarr;</button>
          </div>
        </div>
        <div style="height:200px;"><canvas id="weightChart"></canvas></div>
      </div>
      <div class="panel" style="margin-top:12px;">
        <h3 id="typePieTitle">ç·´ç¿’å‰²åˆ</h3>
        <div style="height:220px; position:relative;"><canvas id="typePieChart"></canvas></div>
      </div>
    </section>

    <section id="ai_coach" class="tabpanel">
      <div class="panel">
        <h3>AIå°‚å±ã‚³ãƒ¼ãƒ</h3>
        <details style="margin-bottom: 15px; border: 1px solid var(--line); padding: 10px; border-radius: 8px; background:var(--bg);">
          <summary style="cursor: pointer; font-weight: bold;">âš™ï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</summary>
          <div style="margin-top: 10px; display:flex; flex-direction:column; gap:8px;">
            <div>
              <label>å°‚é–€ç¨®ç›®</label>
              <input type="text" id="aiSpecialty" placeholder="ä¾‹: 5000m">
            </div>
            <div>
              <label>ç›®æ¨™ã‚¿ã‚¤ãƒ  (SB)</label>
              <input type="text" id="aiSb" placeholder="ä¾‹: 15åˆ†30ç§’">
            </div>
            <div>
              <label>ç”³ã—é€ã‚Šäº‹é … (æ€ªæˆ‘ãƒ»ä½“èª¿ãªã©)</label>
              <textarea id="aiNote" style="height: 60px;" placeholder="ä¾‹: å³è†ã«é•å’Œæ„Ÿã‚ã‚Š"></textarea>
            </div>
            <button id="saveAiProfileBtn" onclick="saveAiProfile()" class="ghost" style="align-self:flex-start;">è¨­å®šã‚’ä¿å­˜</button>
          </div>
        </details>

        <div id="aiConfig" style="margin-bottom:10px;">
          <label style="font-size:10px; color:var(--muted);">Gemini API Key</label>
          <input type="password" id="geminiApiKey" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›" class="form-control" style="font-size:12px; margin-top:4px;" />
        </div>

        <div class="chat-container">
          <div id="aiChatLog" class="chatlog" style="min-height:300px; max-height:500px; background:var(--bg); border:1px solid var(--line); border-radius:8px; padding:10px;">
            <div class="msg system">
              <span class="txt">ã“ã‚“ã«ã¡ã¯ï¼AIã‚³ãƒ¼ãƒã§ã™ã€‚<br>ã€Œåˆ†æé–‹å§‹ã€ã‚’æŠ¼ã™ã¨ã€ç›´è¿‘7æ—¥é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¾ã™ã€‚</span>
            </div>
          </div>
          <div class="chat-input-area" style="margin-top:10px;">
            <button id="runAiBtn" class="primary" style="white-space:nowrap;">ğŸ“Š åˆ†æé–‹å§‹</button>
            <input id="aiChatInput" class="form-control" placeholder="è³ªå•ã‚’å…¥åŠ›..." />
            <button id="aiSendBtn" class="ghost">é€ä¿¡</button>
          </div>
        </div>
      </div>
    </section>

    <section id="memo" class="tabpanel">
      <div class="panel">
        <h3>ãƒãƒ¼ãƒ ãƒ¡ãƒ¢</h3>
        <div id="memoChatBox" class="chat">
          <div id="memoChatLog" class="chatlog" style="max-height:400px;"></div>
          <div class="chat-input-area">
            <input id="memoChatInput" class="form-control" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸..." />
            <button id="memoSendBtn" class="primary">é€ä¿¡</button>
          </div>
        </div>
      </div>
    </section>

    <section id="notify" class="tabpanel">
      <div class="panel">
        <h3>é€šçŸ¥</h3>
        <div id="notifyList" class="chatlog"></div>
        <div class="muted" id="notifyEmpty" style="display:none; padding:12px 0;">ãªã—</div>
      </div>
    </section>
  </div>

  <div id="login" class="login">
    <div class="login-card">
      <div class="logo">AthLog</div>
      <div class="desc">Login</div>
      <label>Team ID</label>
      <input id="teamId" />
      <label>Member</label>
      <input id="memberName" />
      <button id="loginBtn" class="primary wide">Enter</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA8oCOusnqZCSax9ZY3-n4KNt2AxEmvT-E",
      authDomain: "athlog-126d2.firebaseapp.com",
      projectId: "athlog-126d2",
      storageBucket: "athlog-126d2.appspot.com",
      messagingSenderId: "784178114661",
      appId: "1:784178114661:web:d41103b0dad1187b85168c"
    };
    if (!firebase.apps || !firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
  </script>
  <script src="app.js?v=20251220_final" defer></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(console.error); });
    }
  </script>
</body>
</html>

