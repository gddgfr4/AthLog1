:root{
  --bg:#f8fafc; --panel:#ffffff; --text:#1e293b; --muted:#64748b;
  --primary:#4f46e5; --chip:#e2e8f0; --chip-on:#dbeafe; --line:#cbd5e1;
  --q-jog:#bfdbfe; --q-point:#fed7aa; --q-sup:#bbf7d0; --q-off:#e5e7eb; --q-other:#f5d0fe;
  /* ▼ 月一覧用の薄色を追加 */
  --q-jog-light:#f0f9ff;
  --q-point-light:#fffbeb;
  --q-sup-light:#f0fdf4;
  --q-off-light:#f8fafc;
  --q-other-light:#fef7ff;
  /* ▲ ここまで追加 */
  --cond1:#ef4444; --cond2:#f97316; --cond3:#eab308; --cond4:#84cc16; --cond5:#22c55e;
}

*{ box-sizing:border-box; }
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Hiragino Sans",Meiryo,sans-serif;
}

.hidden{ display:none !important; }

/* ========== Topbar ========== */
.topbar{
  display:flex; align-items:center; gap:12px; flex-wrap:wrap;
  padding:10px 16px; background:var(--panel); border-bottom:1px solid var(--line);
}
.brand{ font-weight:700; }
.ghost{
  background:transparent; border:1px solid var(--line); color:var(--text);
  padding:6px 10px; border-radius:10px; cursor:pointer;
}
.primary{
  background:var(--primary); border:none; color:#fff;
  padding:8px 14px; border-radius:12px; cursor:pointer;
}
.badge{
  display:inline-block; padding:2px 6px; border-radius:6px;
  font-size:12px; line-height:1; border:1px solid rgba(0,0,0,.08);
}
.badge.primary{ background:#2563eb; color:#fff; }
.badge.warn{ background:#f59e0b; color:#1f2937; }

/* ========== Tabs ========== */
.tabs{ display:flex; gap:8px; padding:8px 16px; border-bottom:1px solid var(--line); }
.tab{
  position:relative;
  background:transparent; border:1px solid var(--line); color:var(--text);
  padding:6px 12px; border-radius:10px; cursor:pointer;
}
.tab.active{ background:var(--chip-on); }
.tab.new-message::after{
  content:''; position:absolute; top:4px; right:4px;
  width:8px; height:8px; border-radius:50%; background:var(--primary);
  border:1px solid var(--panel);
}

.tabpanel{ display:none; padding:14px; }
.tabpanel.active{ display:block; }

/* ========== Panels & Layout ========== */
.panel{
  background:var(--panel); border:1px solid var(--line);
  border-radius:14px; padding:12px;
}
.panel.right{ display:flex; flex-direction:column; gap:12px; }

/* 2カラム（左：筋マップ / 右：フォーム類） */
.journal-grid{
  display:grid; gap:12px;
  grid-template-columns:minmax(420px,1fr) minmax(420px,0.9fr);
}

/* スマホ：フォーム→筋マップの順に縦並び */
@media (max-width:768px){
  .journal-grid{ display:flex !important; flex-direction:column; gap:12px; }
  .journal-grid .panel{ order:2; }
  .journal-grid .panel.right{ order:1; }
}

/* === muscle map === */
#mmWrap{
  position:relative;
  max-width:680px;
  margin:12px auto;
}
#mmWrap img{
  display:block;
  width:100%;
  height:auto;         /* 画像に合わせて親の高さが決まる */
}
#mmWrap canvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;         /* ← ここを 100% にする（auto 禁止） */
  display:block;
  image-rendering:pixelated;
}
#mmBase   { z-index:0; opacity:0; pointer-events:none; }
#mmBarrier{ z-index:1; opacity:0; pointer-events:none; } /* 見えない壁 */
#mmOverlay{ z-index:2; cursor:crosshair; }


/* ========== Palette ========== */
.palette{ display:flex; gap:8px; align-items:center; margin-bottom:6px; }
.lvl{
  border:1px solid var(--line); background:#f1f5f9; color:var(--text);
  padding:6px 10px; border-radius:10px; cursor:pointer; font-weight:700;
}
.lvl.active{ outline:2px solid var(--primary); }
#eraser{ background:#eef2ff; color:#1e3a8a; border:1px solid var(--line); }
.dot{ display:inline-block; width:14px; height:14px; border-radius:3px; margin-right:6px; vertical-align:-2px; }
.dot1{ background:#c7d2fe; } /* lv1 (青系) */
.dot2{ background:#fdbA74; } /* lv2 (橙系) */
.dot3{ background:#ef4444; } /* lv3 (赤系) */

/* ========== Week bar / Chips ========== */
.weekbar{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:8px; }
#datePicker{ margin-left:auto; }
.chips{
  flex:1 1 100%; order:2;
  display:flex; gap:6px; overflow-x:auto; padding:4px 2px;
  -webkit-overflow-scrolling:touch; scrollbar-width:thin;
}
.chips::-webkit-scrollbar{ height:6px; }
.chip{
  display:inline-flex; flex-direction:column; align-items:center; justify-content:center;
  gap:2px; min-width:64px; padding:8px 10px;
  background:var(--chip); border:1px solid var(--line); border-radius:12px;
  cursor:pointer; text-align:center; color:var(--text); line-height:1.1;
}
.chip.active{ outline:2px solid var(--primary); }
.km{ font-size:12px; color:var(--muted); }

@media (max-width:520px){
  .chip{ min-width:56px; padding:6px 8px; }
}

/* ========== Quick tags ========== */
.quick{
  display:flex; align-items:center; gap:8px;
  background:var(--panel); border:1px solid var(--line); padding:8px; border-radius:10px;
}
.qbtn{
  border:none; color:#1f2735; padding:8px 14px; border-radius:8px; cursor:pointer; font-weight:500;
}
.qbtn.jog{ background:var(--q-jog); }
.qbtn.point{ background:var(--q-point); }
.qbtn.sup{ background:var(--q-sup); }
.qbtn.off{ background:var(--q-off); }
.qbtn.other{ background:var(--q-other); }
.qbtn.active{ outline:2px solid var(--primary); outline-offset:2px; }


.comment-box {
  margin-top: 12px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  background: #fafafa;
}
.comment-box textarea {
  width: 100%;
  margin-top: 6px;
  padding: 6px;
}
.comment-box button {
  margin-top: 6px;
  padding: 6px 12px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 4px;
}
.comment-item {
  margin-top: 6px;
  padding: 4px;
  border-top: 1px dashed #ddd;
  font-size: 14px;
}


/* ========== Forms ========== */
.formcol{ display:flex; flex-direction:column; gap:10px; }
.formcol input,
.formcol textarea,
.filters select,
.filters input,
.form-control{
  width:100%; background:var(--bg); border:1px solid var(--line);
  color:var(--text); border-radius:10px; padding:8px;
}
.note .merge{ display:flex; gap:6px; margin-top:6px; }
.savebar{ display:flex; justify-content:space-between; align-items:center; }
.muted{ color:var(--muted); font-size:12px; }

#feelInput{ min-height:12em; } /* 感想は少し高め */

/* ========== Condition rating ========== */
.condition-rating{ display:flex; gap:4px; margin-top:4px; }
.condition-rating button{
  border:1px solid var(--line); background:transparent; color:var(--text);
  width:30px; height:30px; border-radius:50%; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.condition-rating button.active{
  background:var(--primary); color:#fff; border-color:var(--primary); font-weight:700;
}

.condition-display{ display:flex; gap:2px; }
.condition-display .star{ font-size:14px; }
.condition-display .star.c1{ color:var(--cond1); }
.condition-display .star.c2{ color:var(--cond2); }
.condition-display .star.c3{ color:var(--cond3); }
.condition-display .star.c4{ color:var(--cond4); }
.condition-display .star.c5{ color:var(--cond5); }

/* ========== Month list ========== */
.monthbar{
  display:flex; gap:8px; align-items:center;
  background:var(--panel); padding:10px; border:1px solid var(--line); border-radius:12px; margin-bottom:8px;
}
.list{ display:flex; flex-direction:column; gap:6px; }
.row{
  display:grid; grid-template-columns: 60px 1fr; gap: 8px; align-items:stretch; /* 隙間を詰め、高さを均等に */
  background:var(--panel); border:1px solid var(--line); border-radius:10px; padding: 6px 8px; cursor:pointer; /* パディング調整 */
}
.row .dow{ 
  color:var(--muted); 
  /* width:56px; */ /* gridが幅を管理 */
  text-align:center; 
  font-weight: bold;
  border-radius: 6px; /* 角丸 */
  padding: 4px 0; /* 上下パディング */
  line-height: 1.1;
  
  /* 以下を追加: 中央揃え＆高さ一杯 */
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
}
.row .txt{ color:var(--text); display:flex; flex-direction:column; gap:4px; align-items:flex-start; }

.month-tags{ display:flex; gap:4px; }
.cat-tag{
  color:#1e293b; padding:2px 8px; border-radius:8px; font-size:12px; font-weight:500; white-space:nowrap;
}
.cat-tag.jog{ background:var(--q-jog); }
.cat-tag.point{ background:var(--q-point); }
.cat-tag.sup{ background:var(--q-sup); }
.cat-tag.off{ background:var(--q-off); }
.cat-tag.other{ background:var(--q-other); }

/* ========== Plans (chat) ========== */
.chatwrap{ margin-top:10px; }
.chat{
  background:var(--panel); border:1px solid var(--line); border-radius:10px; padding:8px;
}
.chatlog{ max-height:180px; overflow:auto; margin-bottom:6px; font-size:14px; }
.chat-input-area{ display:flex; gap:8px; margin-top:6px; }
#chatInput,#memoChatInput{
  width:100%; background:var(--bg); border:1px solid var(--line);
  color:var(--text); border-radius:10px; padding:8px;
}
.msg{ margin:6px 0; }
.msg .name{ color:var(--primary); margin-right:6px; }

/* ========== Dashboard ========== */
.dash-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.dash-header h3{ margin:0; }
.dash-controls{ display:flex; gap:8px; align-items:center; }

/* ========== Login + Help Overlay ========== */
.login{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.5);
}
.login-card{
  background:var(--panel); border:1px solid var(--line); border-radius:14px;
  padding:20px; min-width:300px; box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.login .logo{ font-weight:800; font-size:22px; margin-bottom:6px; }
.login .desc{ color:var(--muted); margin-bottom:12px; }
.login input{
  width:100%; background:var(--bg); border:1px solid var(--line);
  color:var(--text); padding:8px; border-radius:10px; margin-bottom:10px;
}
.login .wide{ width:100%; }

#helpOverlay .logo{ font-weight:800; font-size:20px; margin-bottom:4px; }
#helpOverlay .desc{ color:var(--muted); margin-bottom:10px; }
#helpBody.doc{
  background:var(--bg); border:1px solid var(--line); border-radius:10px; padding:12px; color:var(--text);
}
#helpBody h2,#helpBody h3{ margin:12px 0 6px; }
#helpBody p,#helpBody li{ line-height:1.6; }
#helpBody ul{ padding-left:1.2em; }

/* ========== Topbar: モバイル最適化 ========== */
@media (max-width:720px){
  .topbar{ gap:8px; padding:8px 10px; }
  .brand{ display:none; }
  .topbar .teamuser{ 
    gap:8px; 
    margin-left:auto; 
    /* 縦長になる原因のラッピングを解除し、横並びを強制 */
    flex-wrap: nowrap; 
    overflow-x: auto; /* 項目が多すぎる場合、横スクロールを許可 */
    /* min-width: 0; を追加することで、Flexアイテムが幅を占有しすぎるのを防げます */
    min-width: 0; 
  }
  /* テキストを少し減らして詰める */
  #memberLabel{ display:none; }
  /* セレクター幅調整 */
  #memberSelect,#teamSwitchSelect{
    flex:1 1 140px; min-width:120px; max-width:48%;
  }
  /* ヘルプ/ログアウトはアイコン風 */
  #openHelpBtn,#logoutBtn{
    width:36px; height:36px; padding:0; font-size:0; line-height:36px;
    display:inline-flex; align-items:center; justify-content:center;
  }
  #openHelpBtn::before{ content:"❓"; font-size:18px; }
  #logoutBtn::before{ content:"⎋"; font-size:18px; }
  #setAsMainBtn{ padding:6px 8px; font-size:0; }
  #setAsMainBtn::before{ content:"★"; font-size:16px; }
}

#mmWrap{position:relative;max-width:680px;margin:12px auto;}
#mmWrap canvas{
  position:absolute; inset:0;
  display:block; width:100%; height:auto;
  touch-action:none;
}
#mmBase{z-index:0;}
#mmBarrier{z-index:1; opacity:0; pointer-events:none;} /* 見えない壁 */
#mmOverlay{z-index:2;}

/* どこかのCSSに追加/上書き */
#mmOverlay { touch-action: auto; }

/* === Week chips: スマホ最適化 === */
#weekChips {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
}
#weekChips .chip {
  padding: 6px 4px;
  min-width: 0;
  border-radius: 10px;
  line-height: 1.1;
}
#weekChips .chip .km { font-size: 11px; opacity: .8; }

/* 幅が狭い端末で文字・余白をさらに詰める */
@media (max-width: 420px){
  #weekChips { gap: 4px; }
  #weekChips .chip { padding: 5px 3px; }
  #weekChips .chip div:first-child { font-size: 12px; }
  #weekChips .chip .km { font-size: 10px; }
}

/* === 予定反映UIのコンパクト化 === */
.journal-merge-row {
  display: flex;
  gap: 6px;
  align-items: center;
  margin: 6px 0;
}
.journal-merge-row .form-control,
.journal-merge-row select,
.journal-merge-row input,
.journal-merge-row button {
  height: 30px;
  padding: 4px 8px;
  line-height: 22px;
  font-size: 13px;
}
#mergeTagFilter { max-width: 160px; }
#mergeScope { max-width: 160px; }
#mergeBtn { white-space: nowrap; }


/* === 月一覧：調子のピル表示 & 本文2行制限 === */
.month-tags { display: inline-flex; gap: 6px; flex-wrap: wrap; }

.cond-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px; height: 22px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 700;
  color: #fff;
  margin-left: auto; /* ← これを追加 */
  flex-shrink: 0; /* 縮まないように */
}
.cond-1 { background:#9CA3AF; }  /* gray */
.cond-2 { background:#60A5FA; }  /* blue */
.cond-3 { background:#34D399; }  /* green */
.cond-4 { background:#F59E0B; }  /* amber */
.cond-5 { background:#EF4444; }  /* red  */

.month-content-2lines {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-height: 1.3;
  white-space: normal;
  max-height: calc(1.3em * 2);
}

/* Chartの縦伸び防止：キャンバスの高さを固定 */
.card canvas,
#distanceChartDay, #distanceChartWeek, #distanceChartMonth,
#distanceChart /* 念のため既存IDもカバー */
{
  width: 100% !important;
  height: 180px !important;   /* ← 必要な高さに固定（好みで 160〜220px に） */
  display: block;
}

/* 月一覧の縦色ラベル */
.typebar {
  width: 8px !important;               /* 縦棒の太さ */
  align-self: stretch;      /* 行の高さに合わせて伸びる */
  border-radius: 3px;
  background: #e5e7eb;      /* デフォルト（無色時の薄グレー） */
  margin-right: 8px;        /* 日付との間隔 */
}

/* 日付部分を一行表示 */
.row .dow {
  font-weight: bold;
  margin-right: 8px;
  white-space: nowrap;
}

/* 1行レイアウト */
.month-one-line {
  display: flex;
  align-items: center;
  gap: 0px;
  min-width: 0;
}
.month-train-ellipsis {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.month-one-line .km {
  flex: 0 0 auto;
  opacity: .8;
  padding-right: 8px; /* ← 練習内容との隙間を追加 */
  white-space: nowrap; /* 距離が改行しないように */
}

/* 縦色バー：濃く */
.type-bar {
  width: 6px;
  height: 100%;
  margin-right: 6px;
  flex-shrink: 0;
}
.type-bar.jog    { background: #1d4ed8; } /* 濃い青 */
.type-bar.point  { background: #dc2626; } /* 濃い赤 */
.type-bar.sup    { background: #059669; } /* 濃い緑 */
.type-bar.off    { background: #4b5563; } /* 濃い灰色 */
.type-bar.other  { background: #9333ea; } /* 濃い紫 */

/* 画面上部の共通スワイプバー（透明） */
#globalSwipeBar{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 28px;           /* 好みで 24~40px に */
  z-index: 50;
  /* 縦スクロールは通しつつ、横ジェスチャはJSが拾えるように */
  touch-action: pan-y pinch-zoom;
  background: transparent;
}

/* ▼ 時計タブ時は上部共通UIを隠す */
.mode-clock header,
.mode-clock .global-nav { display: none !important; }

/* ▼ Ltimer 風（最低限） */
.ltimer { max-width: 720px; margin: 0 auto; display: grid; gap: 12px; }
.ltimer-face { display:flex; justify-content:center; padding: 12px 0; }
#clock-display { font-size: clamp(40px, 8vw, 80px); letter-spacing:.02em; font-variant-numeric: tabular-nums; }
.ltimer-controls { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
.ltimer-controls button { padding:10px 16px; border-radius:12px; border:1px solid #333; background:#151517; color:#eee; cursor:pointer; }
.ltimer-laps { background:#0e0e10; border:1px solid #222; border-radius:12px; padding:8px 12px; max-height:45vh; overflow:auto; }
#lap-list { margin:0; padding-left: 20px; }
#lap-list li { padding:6px 0; border-bottom:1px dashed #222; }
#lap-list li:last-child { border-bottom:none; }

/* style.css (末尾に追加) */

/* ========== 通知リストの改善 ========== */
#notifyList {
  /* chatlog のスタイルを継承しているため、ここでは通知専用の調整 */
  display: flex; /* Flexboxで縦に並べる */
  flex-direction: column;
  gap: 10px; /* アイテム間の隙間 */
  padding: 0; /* 親の padding は panel にあるのでここではリセット */
}

.notify-card {
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05); /* 軽い影で浮き出し */
  cursor: default; /* デフォルトでカーソルを変更しない */
}

.notify-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  border-bottom: 1px solid var(--line); /* ヘッダーとコンテンツの区切り線 */
  padding-bottom: 6px;
  margin-bottom: 8px;
}

.notify-header .notify-icon {
  font-size: 1.2em;
  line-height: 1;
}

.notify-header .notify-title {
  flex: 1;
  color: var(--primary);
}

.notify-header .date {
  font-size: 11px;
  color: var(--muted);
  font-weight: 400;
  white-space: nowrap; /* 日付が改行しないように */
}

.notify-content {
  padding-top: 4px;
}

.notify-day-link {
  color: var(--primary);
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  padding: 4px 0;
  display: block;
}

.notify-comment-text {
  margin-top: 8px;
  padding: 8px;
  background: var(--bg); /* コメント本文を背景色で囲む */
  border-radius: 6px;
  border: 1px solid var(--line);
  font-size: 14px;
  white-space: pre-wrap;
}

/* ========== 通知リストのレイアウト・デザイン修正 (最終版) ========== */

/* 1. 通知タブ (#notify) がアクティブな時のみ、縦方向のFlexコンテナとして振る舞う */
/* これにより、他のタブパネル (日誌など) は元のブロック表示を維持し、レイアウトが崩れない */
#notify.tabpanel.active {
  /* .tabpanel.active の display: block を display: flex に上書き */
  display: flex; 
  flex-direction: column;
  
  /* 画面全体高から topbar + tabsの高さを引く */
  min-height: calc(100vh - 120px); 
}

/* 2. 通知パネル内の .panel が親 (通知タブ) の高さをすべて占めるようにする */
#notify .panel {
  flex-grow: 1; 
  display: flex;
  flex-direction: column;
  min-height: 0; /* Flexアイテムの最小高さのオーバーライド */
}

/* 3. 通知リスト (#notifyList) が残りの高さを占め、スクロール可能領域となる */
#notifyList {
  flex-grow: 1; 
  overflow-y: auto; /* 縦スクロールを有効化 */
  max-height: none !important; /* 過去の制限を解除 */
  
  /* カード型レイアウトの調整 */
  gap: 10px; 
  padding: 0; 
  padding-bottom: 12px;
  display: flex;
  flex-direction: column;
}

/* 4. 通知カードのデザイン（視認性向上） */
.notify-card {
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  cursor: default;
}

.notify-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  border-bottom: 1px solid var(--line);
  padding-bottom: 6px;
  margin-bottom: 8px;
}

.notify-header .notify-icon {
  font-size: 1.2em;
  line-height: 1;
}

.notify-header .notify-title {
  flex: 1;
  color: var(--primary);
}

.notify-header .date {
  font-size: 11px;
  color: var(--muted);
  font-weight: 400;
  white-space: nowrap;
}

.notify-content {
  padding-top: 4px;
}

.notify-day-link {
  color: var(--primary);
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  padding: 4px 0;
  display: block;
}

/* 5. コメント本文の縦伸びと視認性の確保 */
.notify-comment-text {
  margin-top: 8px;
  padding: 8px;
  background: var(--bg); 
  border-radius: 6px;
  border: 1px solid var(--line);
  font-size: 14px;
  white-space: pre-wrap;
  min-height: 3em;      /* 少なくとも3行分の高さを確保 */
  max-height: none;     /* 予期せぬ高さ制限を解除 */
  overflow: hidden;     /* 意図しないスクロールを防止 */
}

/* style.css (末尾に追加) */

/* 新しいメンバーナビゲーションボタンのスタイル */
.topbar .small-btn {
  width: 32px; /* 小さくする */
  height: 32px;
  padding: 0;
  line-height: 30px;
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  border-radius: 50%; /* 丸くする */
  flex-shrink: 0; /* 縮まないように */
}

/* style.css (末尾の @media (max-width:720px) ブロックをこれに置き換え) */

@media (max-width:720px){
  /* =========================================
     1. トップバー (極小・1行レイアウト)
     ========================================= */
  #openHelpBtn, .brand, #teamSwitchWrap { display: none !important; }

  .topbar {
    padding: 2px 4px !important;
    gap: 2px !important;
    min-height: 28px !important;
    height: auto !important;
    flex-wrap: nowrap !important;
    border-bottom-width: 1px !important;
  }

  .topbar .teamuser {
    margin-left: 0 !important;
    gap: 4px !important;
    width: 100% !important;
    justify-content: space-between !important;
    align-items: center !important;
    display: flex !important;
  }

  .topbar #memberNavWrap > span { font-size: 0 !important; display: flex !important; align-items: center !important; gap: 4px; }
  .topbar #memberNavWrap > span > * { font-size: 12px !important; }

  .topbar .teamuser > span:nth-child(1) {
    font-size: 11px !important; white-space: nowrap; transform: scale(0.95); transform-origin: left center;
  }
  #memberSelect {
    height: 24px !important; padding: 0 2px !important; font-size: 12px !important; border-radius: 4px !important;
  }
  .topbar .teamuser .small-btn {
    width: 24px !important; height: 24px !important; line-height: 22px !important; font-size: 12px !important; padding: 0 !important; margin: 0 !important;
  }
  #logoutBtn {
    width: 24px !important; height: 24px !important; padding: 0 !important; font-size: 0 !important; line-height: 24px !important; display: inline-flex !important; align-items: center; justify-content: center;
  }
  #logoutBtn::before { content: "⎋"; font-size: 14px !important; }
  .badge { padding: 1px 3px !important; font-size: 9px !important; border-radius: 3px !important; }


  /* =========================================
     2. タブメニュー (横幅いっぱい・自動伸縮)
     ========================================= */
  .tabs {
    /* 左右の余白をゼロにして画面幅を最大利用 */
    padding: 4px 0 !important; 
    gap: 4px !important;
    border-bottom-width: 1px !important;
    
    /* 横スクロールを滑らかに */
    display: flex !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  
  .tab {
    /* 縮まず(0)、必要なら伸びる(1)、ベース幅は自動(auto) */
    flex: 1 0 auto !important; 
    
    padding: 4px 12px !important; /* タップしやすい幅を確保 */
    font-size: 11px !important;
    border-radius: 6px !important;
    text-align: center !important;
  }
  
  /* 最初と最後のタブが画面端に張り付きすぎないように微調整 */
  .tab:first-child { margin-left: 4px !important; }
  .tab:last-child { margin-right: 4px !important; }


  /* =========================================
     3. 日誌パネル・レイアウト (余白圧縮)
     ========================================= */
  .tabpanel { padding: 4px !important; }
  .panel {
    padding: 8px !important; margin-bottom: 8px !important; border-radius: 8px !important;
  }
  .panel.right { gap: 6px !important; }
  .journal-grid { display: flex !important; flex-direction: column !important; gap: 8px !important; }


  /* =========================================
     4. フォーム要素のコンパクト化
     ========================================= */
  .weekbar { margin-bottom: 4px !important; gap: 4px !important; }
  #weekChips { gap: 3px !important; }
  #weekChips .chip { padding: 4px 2px !important; border-radius: 6px !important; min-width: 0 !important; }
  #weekChips .chip div:first-child { font-size: 10px !important; }
  #weekChips .chip .km { font-size: 9px !important; }
  
  .quick { padding: 4px !important; gap: 4px !important; margin-bottom: 0 !important; }
  .qbtn {
    padding: 4px 0 !important; width: 100%; font-size: 11px !important; border-radius: 4px !important; height: 26px !important; line-height: 18px !important;
  }

  .formcol { gap: 6px !important; }
  label { font-size: 10px !important; margin-bottom: 1px !important; line-height: 1 !important; display: block; }
  
  input[type="number"], input[type="text"], input[type="date"], textarea, select, .form-control {
    padding: 3px 6px !important; font-size: 13px !important; border-radius: 4px !important; min-height: 28px !important; height: auto !important;
  }
  
  .condition-rating button {
    width: 26px !important; height: 26px !important; font-size: 11px !important; border-width: 1px !important; margin: 0 1px !important;
  }
  
  .note { margin-top: 2px !important; }
  textarea { min-height: 4.5em !important; }
  
  .formcol > div[style*="display:flex"] { gap: 6px !important; align-items: flex-end !important; }
}

/* style.css (末尾のスクショモード設定をすべて上書き) */

/* style.css (末尾のスクショモード設定をすべて上書き) */

/* ========== スクショモード (Share Mode) ========== */
body.share-mode {
  background-color: #fff !important;
  overflow-y: auto;
}

/* --- 1. 不要な要素を非表示 --- */
body.share-mode .topbar,
body.share-mode .tabs,
body.share-mode #globalSwipeBar,
body.share-mode .weekbar,         
body.share-mode .quick,           
body.share-mode .palette,
body.share-mode .panel h3,
body.share-mode .merge,
body.share-mode #teamSharedCommentBox,
body.share-mode .savebar,
body.share-mode #eraser,
body.share-mode #shareModeBtn,
body.share-mode section.tabpanel:not(#journal) 
{
  display: none !important;
}

/* --- 2. レイアウト調整 --- */
body.share-mode #app {
  padding: 0;
  height: auto;
  display: block;
}

body.share-mode .tabpanel {
  padding: 16px !important;
  display: block !important;
  height: auto !important;
}

body.share-mode .journal-grid {
  display: flex !important;
  flex-direction: column;
  gap: 12px;
}

body.share-mode .panel {
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 !important;
  background: transparent !important;
}

/* --- 3. 入力フォームのデザイン --- */
body.share-mode input, 
body.share-mode textarea,
body.share-mode .form-control {
  border: 1px solid var(--line) !important;
  background: var(--bg) !important;
  padding: 8px !important;
  border-radius: 8px !important;
  font-weight: normal;
  color: var(--text);
  overflow: hidden; 
  /* ★修正: height指定を削除し、JSの自動調整を有効にする */
  min-height: 0 !important; 
}

/* フォーム周りのレイアウト */
body.share-mode .formcol {
  gap: 12px !important;
}

body.share-mode .formcol > div[style*="display:flex"] {
  justify-content: flex-start;
  gap: 12px !important;
}

/* --- 4. 専用ヘッダー (日付 + カテゴリ) --- */
#shareHeader {
  display: none;
}
body.share-mode #shareHeader {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap; 
  gap: 8px;        
  margin-bottom: 16px;
}
body.share-mode #shareHeader .date-text {
  font-size: 20px;
  font-weight: 800;
  color: var(--primary);
  margin-right: 4px;
  font-family: monospace, serif;
}

/* ★修正: カテゴリボタンを元のサイズ感に戻す */
body.share-mode #shareHeader .qbtn {
  pointer-events: none;
  width: auto !important;       /* 幅を自動に戻す */
  padding: 6px 12px !important; /* 適度な余白 */
  height: auto !important;      /* 高さを自動に */
  line-height: 1.4 !important;
  margin: 0 !important;
  flex: initial !important;     /* 伸び縮みさせない */
}

/* --- 5. 筋疲労マップ --- */
body.share-mode #mmWrap {
  width: 60% !important;
  max-width: 300px;
  margin: 10px auto 0 auto !important;
}
