:root{
  --bg:#f8fafc; --panel:#ffffff; --text:#1e293b; --muted:#64748b;
  --primary:#4f46e5; --chip:#e2e8f0; --chip-on:#dbeafe; --line:#cbd5e1;
  --q-jog:#bfdbfe; --q-point:#fed7aa; --q-sup:#bbf7d0; --q-off:#e5e7eb; --q-other:#f5d0fe;
  --cond1:#ef4444; --cond2:#f97316; --cond3:#eab308; --cond4:#84cc16; --cond5:#22c55e;
}

*{ box-sizing:border-box; }
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Hiragino Sans",Meiryo,sans-serif;
}

.hidden{ display:none !important; }

/* ========== Topbar ========== */
.topbar{
  display:flex; align-items:center; gap:12px; flex-wrap:wrap;
  padding:10px 16px; background:var(--panel); border-bottom:1px solid var(--line);
}
.brand{ font-weight:700; }
.ghost{
  background:transparent; border:1px solid var(--line); color:var(--text);
  padding:6px 10px; border-radius:10px; cursor:pointer;
}
.primary{
  background:var(--primary); border:none; color:#fff;
  padding:8px 14px; border-radius:12px; cursor:pointer;
}
.badge{
  display:inline-block; padding:2px 6px; border-radius:6px;
  font-size:12px; line-height:1; border:1px solid rgba(0,0,0,.08);
}
.badge.primary{ background:#2563eb; color:#fff; }
.badge.warn{ background:#f59e0b; color:#1f2937; }

/* ========== Tabs ========== */
.tabs{ display:flex; gap:8px; padding:8px 16px; border-bottom:1px solid var(--line); }
.tab{
  position:relative;
  background:transparent; border:1px solid var(--line); color:var(--text);
  padding:6px 12px; border-radius:10px; cursor:pointer;
}
.tab.active{ background:var(--chip-on); }
.tab.new-message::after{
  content:''; position:absolute; top:4px; right:4px;
  width:8px; height:8px; border-radius:50%; background:var(--primary);
  border:1px solid var(--panel);
}

.tabpanel{ display:none; padding:14px; }
.tabpanel.active{ display:block; }

/* ========== Panels & Layout ========== */
.panel{
  background:var(--panel); border:1px solid var(--line);
  border-radius:14px; padding:12px;
}
.panel.right{ display:flex; flex-direction:column; gap:12px; }

/* 2カラム（左：筋マップ / 右：フォーム類） */
.journal-grid{
  display:grid; gap:12px;
  grid-template-columns:minmax(420px,1fr) minmax(420px,0.9fr);
}

/* スマホ：フォーム→筋マップの順に縦並び */
@media (max-width:768px){
  .journal-grid{ display:flex !important; flex-direction:column; gap:12px; }
  .journal-grid .panel{ order:2; }
  .journal-grid .panel.right{ order:1; }
}

/* === muscle map === */
#mmWrap{
  position:relative;
  max-width:680px;
  margin:12px auto;
}
#mmWrap img{
  display:block;
  width:100%;
  height:auto;         /* 画像に合わせて親の高さが決まる */
}
#mmWrap canvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;         /* ← ここを 100% にする（auto 禁止） */
  display:block;
  image-rendering:pixelated;
}
#mmBase   { z-index:0; opacity:0; pointer-events:none; }
#mmBarrier{ z-index:1; opacity:0; pointer-events:none; } /* 見えない壁 */
#mmOverlay{ z-index:2; cursor:crosshair; }


/* ========== Palette ========== */
.palette{ display:flex; gap:8px; align-items:center; margin-bottom:6px; }
.lvl{
  border:1px solid var(--line); background:#f1f5f9; color:var(--text);
  padding:6px 10px; border-radius:10px; cursor:pointer; font-weight:700;
}
.lvl.active{ outline:2px solid var(--primary); }
#eraser{ background:#eef2ff; color:#1e3a8a; border:1px solid var(--line); }
.dot{ display:inline-block; width:14px; height:14px; border-radius:3px; margin-right:6px; vertical-align:-2px; }
.dot1{ background:#c7d2fe; } /* lv1 (青系) */
.dot2{ background:#fdbA74; } /* lv2 (橙系) */
.dot3{ background:#ef4444; } /* lv3 (赤系) */

/* ========== Week bar / Chips ========== */
.weekbar{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:8px; }
#datePicker{ margin-left:auto; }
.chips{
  flex:1 1 100%; order:2;
  display:flex; gap:6px; overflow-x:auto; padding:4px 2px;
  -webkit-overflow-scrolling:touch; scrollbar-width:thin;
}
.chips::-webkit-scrollbar{ height:6px; }
.chip{
  display:inline-flex; flex-direction:column; align-items:center; justify-content:center;
  gap:2px; min-width:64px; padding:8px 10px;
  background:var(--chip); border:1px solid var(--line); border-radius:12px;
  cursor:pointer; text-align:center; color:var(--text); line-height:1.1;
}
.chip.active{ outline:2px solid var(--primary); }
.km{ font-size:12px; color:var(--muted); }

@media (max-width:520px){
  .chip{ min-width:56px; padding:6px 8px; }
}

/* ========== Quick tags ========== */
.quick{
  display:flex; align-items:center; gap:8px;
  background:var(--panel); border:1px solid var(--line); padding:8px; border-radius:10px;
}
.qbtn{
  border:none; color:#1f2735; padding:8px 14px; border-radius:8px; cursor:pointer; font-weight:500;
}
.qbtn.jog{ background:var(--q-jog); }
.qbtn.point{ background:var(--q-point); }
.qbtn.sup{ background:var(--q-sup); }
.qbtn.off{ background:var(--q-off); }
.qbtn.other{ background:var(--q-other); }
.qbtn.active{ outline:2px solid var(--primary); outline-offset:2px; }

/* ========== Forms ========== */
.formcol{ display:flex; flex-direction:column; gap:10px; }
.formcol input,
.formcol textarea,
.filters select,
.filters input,
.form-control{
  width:100%; background:var(--bg); border:1px solid var(--line);
  color:var(--text); border-radius:10px; padding:8px;
}
.note .merge{ display:flex; gap:6px; margin-top:6px; }
.savebar{ display:flex; justify-content:space-between; align-items:center; }
.muted{ color:var(--muted); font-size:12px; }

#feelInput{ min-height:12em; } /* 感想は少し高め */

/* ========== Condition rating ========== */
.condition-rating{ display:flex; gap:4px; margin-top:4px; }
.condition-rating button{
  border:1px solid var(--line); background:transparent; color:var(--text);
  width:30px; height:30px; border-radius:50%; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.condition-rating button.active{
  background:var(--primary); color:#fff; border-color:var(--primary); font-weight:700;
}

.condition-display{ display:flex; gap:2px; }
.condition-display .star{ font-size:14px; }
.condition-display .star.c1{ color:var(--cond1); }
.condition-display .star.c2{ color:var(--cond2); }
.condition-display .star.c3{ color:var(--cond3); }
.condition-display .star.c4{ color:var(--cond4); }
.condition-display .star.c5{ color:var(--cond5); }

.aibox{ border-top:1px solid var(--line); padding-top:8px; }
.aiout{ min-height:38px; color:#475569; }

/* ========== Month list ========== */
.monthbar{
  display:flex; gap:8px; align-items:center;
  background:var(--panel); padding:10px; border:1px solid var(--line); border-radius:12px; margin-bottom:8px;
}
.list{ display:flex; flex-direction:column; gap:6px; }
.row{
  display:grid; grid-template-columns:56px 1fr; gap:10px; align-items:center;
  background:var(--panel); border:1px solid var(--line); border-radius:10px; padding:8px; cursor:pointer;
}
.row .dow{ color:var(--muted); width:56px; text-align:center; }
.row .txt{ color:var(--text); display:flex; flex-direction:column; gap:4px; align-items:flex-start; }

.month-tags{ display:flex; gap:4px; }
.cat-tag{
  color:#1e293b; padding:2px 8px; border-radius:8px; font-size:12px; font-weight:500; white-space:nowrap;
}
.cat-tag.jog{ background:var(--q-jog); }
.cat-tag.point{ background:var(--q-point); }
.cat-tag.sup{ background:var(--q-sup); }
.cat-tag.off{ background:var(--q-off); }
.cat-tag.other{ background:var(--q-other); }

/* ========== Plans (chat) ========== */
.chatwrap{ margin-top:10px; }
.chat{
  background:var(--panel); border:1px solid var(--line); border-radius:10px; padding:8px;
}
.chatlog{ max-height:180px; overflow:auto; margin-bottom:6px; font-size:14px; }
.chat-input-area{ display:flex; gap:8px; margin-top:6px; }
#chatInput,#memoChatInput{
  width:100%; background:var(--bg); border:1px solid var(--line);
  color:var(--text); border-radius:10px; padding:8px;
}
.msg{ margin:6px 0; }
.msg .name{ color:var(--primary); margin-right:6px; }

/* ========== Dashboard ========== */
.dash-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.dash-header h3{ margin:0; }
.dash-controls{ display:flex; gap:8px; align-items:center; }

/* ========== Login + Help Overlay ========== */
.login{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.5);
}
.login-card{
  background:var(--panel); border:1px solid var(--line); border-radius:14px;
  padding:20px; min-width:300px; box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.login .logo{ font-weight:800; font-size:22px; margin-bottom:6px; }
.login .desc{ color:var(--muted); margin-bottom:12px; }
.login input{
  width:100%; background:var(--bg); border:1px solid var(--line);
  color:var(--text); padding:8px; border-radius:10px; margin-bottom:10px;
}
.login .wide{ width:100%; }

#helpOverlay .logo{ font-weight:800; font-size:20px; margin-bottom:4px; }
#helpOverlay .desc{ color:var(--muted); margin-bottom:10px; }
#helpBody.doc{
  background:var(--bg); border:1px solid var(--line); border-radius:10px; padding:12px; color:var(--text);
}
#helpBody h2,#helpBody h3{ margin:12px 0 6px; }
#helpBody p,#helpBody li{ line-height:1.6; }
#helpBody ul{ padding-left:1.2em; }

/* ========== Topbar: モバイル最適化 ========== */
@media (max-width:720px){
  .topbar{ gap:8px; padding:8px 10px; }
  .brand{ display:none; }
  .topbar .teamuser{ gap:8px; margin-left:auto; flex-wrap:wrap; }
  /* テキストを少し減らして詰める */
  #memberLabel{ display:none; }
  /* セレクター幅調整 */
  #memberSelect,#teamSwitchSelect{
    flex:1 1 140px; min-width:120px; max-width:48%;
  }
  /* ヘルプ/ログアウトはアイコン風 */
  #openHelpBtn,#logoutBtn{
    width:36px; height:36px; padding:0; font-size:0; line-height:36px;
    display:inline-flex; align-items:center; justify-content:center;
  }
  #openHelpBtn::before{ content:"❓"; font-size:18px; }
  #logoutBtn::before{ content:"⎋"; font-size:18px; }
  #setAsMainBtn{ padding:6px 8px; font-size:0; }
  #setAsMainBtn::before{ content:"★"; font-size:16px; }
}

#mmWrap{position:relative;max-width:680px;margin:12px auto;}
#mmWrap canvas{
  position:absolute; inset:0;
  display:block; width:100%; height:auto;
  touch-action:none;
}
#mmBase{z-index:0;}
#mmBarrier{z-index:1; opacity:0; pointer-events:none;} /* 見えない壁 */
#mmOverlay{z-index:2;}

/* どこかのCSSに追加/上書き */
#mmOverlay { touch-action: auto; }





